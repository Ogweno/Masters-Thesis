<h1>Masters Thesis Code</h1>

<h2>Processing Chain</h2>

<ol>
<li>Select Station folder to be processed</li>
<li><p>Filter Event Directories</p>

<p>Function SortEventDirs.m selects only those directories
which have just numbers as their name. This should 
leave out directories with names such as 'test'.</p></li>
<li><p>Convert sac file format, filter bad picks</p>

<p>Function ConvertTraces uses the function readsac.m to
read in sac data. This data is then sent to freetran
to rotate the coordinates from r and z into p and s.
header file infor is saved into cell array 'header' and
slowness p values are sent to vector 'pslows'</p></li>
<li><p>Window with Taper and fourier transform signal.</p>

<p>p data is windowed with a tukey taper and passed through 
the fft algorithm into 'wft' with fft'd s trace vectors 
going into 'vft'.</p></li>
<li><p>Bin by p value (build pIndex)</p>

<p>Right now an logical index array is created. Each line in the
array is associated with a pbin, and it's columns are the 
zeros and ones which select the appropriate trace that corrisponds
to this bin.</p></li>
<li><p>Impulse Response: Stack and Deconvolve</p>

<p>The sorted fourier transformed signals are sent into simdecf.m
to be deconvolved into what should be something like a greens
function. These are saved in 'rft' which is passed through the
inverse fourier transform to recover 'Rtrace'.</p></li>
<li><p>Filter Impulse Response, aquire data tps</p>

<p>Filter with bandpass filter [0.01 1]hz and use filtered response to select tps as
max values within a certain range (here from 3ish to 5ish seconds).</p></li>
<li><p>IRLS Newtons Method to find regression Tps</p>

<p>Newtons method for non-linear regression with three variables.
Linear solution solving with IRLS solver (homemade but tested and working).
IRLS solver to downweight high residuals, to get a pseudo L1 solution.
Solution is an L1-like non-linear regression fit for the tps data.</p></li>
<li><p>Grid and Line Search</p>

<p>With the Tps found above, solve the tpps and tpss ratios for each
Vp and R in a range of choices. Use the tpps and tpss times to index
into receiver functions, and sum and average all the values in the range
of reciever functions for this Vp and R. This is Gridded out and the
maximum is selected. The best Vp and R are then used to find H in a 
line search. These are plotted over the reviever functions.</p></li>
</ol>

<h3>Still to Complete</h3>

<ul>
<li>Keep track of which traces are removed, and for what reason</li>
<li>Build in some feature that modifies the tps window we do the automatic picks.
This has an impact on the convergence of the Newton Iterations.</li>
<li><p>Develop a database which will store information regarding each stations
processed data, possible errors, needed repicks, date of processing, headers etc. </p>

<ul>
<li>This Database will probably be a cell-array of structures, as described on diagram (not shown here)</li>
</ul></li>
</ul>

<h3>Tuning, testing</h3>

<ul>
<li>Associate particular event and station with bad event</li>
<li>Run testing on pbin logical index array [COMPLETE].</li>
<li>Filter out and flag poorly picked traces [COMPLETE].</li>
<li>Test different filters, compare outcome. </li>
<li>Reproduce results using cross-validation, and similar azimuth station data.</li>
<li>Eigenvalues of Hessian</li>
</ul>

<h3>Change Log</h3>

<h4>February 16th 2012</h4>

<ul>
<li><p>Refactored Code</p>

<h4>December 20th 2011</h4></li>
<li><p>Finished IRLS Newton Solver</p></li>
<li>Encapsulate Newton Solver in a Function.</li>
<li>Tried a few filters, need to try more.</li>
<li>Using similar plots to Paper. - compares well.</li>
<li>Added step 9) Grid Search.</li>
</ul>
